/****** DROP ALL EXISTING TABLES ******/
    IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'dbo.LastUpdatedTimestamp') AND type in (N'U'))
    DROP TABLE dbo.LastUpdatedTimestamp
    IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'dbo.OrderItems') AND type in (N'U'))
    DROP TABLE dbo.OrderItems
    IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'dbo.Orders') AND type in (N'U'))
    DROP TABLE dbo.Orders
    IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'dbo.FulfillmentSites') AND type in (N'U'))
    DROP TABLE dbo.FulfillmentSites
    IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'dbo.DeliveryGroups') AND type in (N'U'))
    DROP TABLE dbo.DeliveryGroups
    IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'dbo.FulfillmentStatuses') AND type in (N'U'))
    DROP TABLE dbo.FulfillmentStatuses
    IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'dbo.OutpostLocations') AND type in (N'U'))
    DROP TABLE dbo.OutpostLocations
    IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'dbo.DiningOptions') AND type in (N'U'))
    DROP TABLE dbo.DiningOptions
    GO

/****** CREATE TABLES ******/
    SET ANSI_NULLS ON
    GO

    SET QUOTED_IDENTIFIER ON
    GO

    CREATE TABLE dbo.LastUpdatedTimestamp(
        LastUpdated     datetime    NOT NULL, /* manual index for PK*/
        FunctionName    varchar(50),
    CONSTRAINT PK_LastUpdatedTimestamp PRIMARY KEY NONCLUSTERED (LastUpdated ASC),
    ) ON [PRIMARY]

    CREATE TABLE dbo.DeliveryGroups(
        GroupID     int         NOT NULL, /* manual index for PK*/
        GroupName   varchar(50) NOT NULL, /* unique */
    CONSTRAINT PK_DeliveryGroups PRIMARY KEY NONCLUSTERED (GroupID ASC),
    CONSTRAINT UNIQUE_DeliveryGroups_GroupName UNIQUE (GroupName)
    ) ON [PRIMARY]

    CREATE TABLE dbo.FulfillmentSites(
        SiteID          int             IDENTITY(1,1) NOT NULL, /* autogenerated index as PK */
        SiteName        varchar(50)     NOT NULL,  /* unique */
        DeliveryGroup   int             NOT NULL,
        Address         varchar(max),
    CONSTRAINT PK_FulfillmentSites PRIMARY KEY NONCLUSTERED (SiteID ASC),
    CONSTRAINT UNIQUE_FulfillmentSites_SiteName UNIQUE (SiteName)
    )ON [PRIMARY]

    CREATE TABLE dbo.FulfillmentStatuses(
        StatusID    int         NOT NULL, /* manual index for PK*/
        StatusName  varchar(50) NOT NULL,  /* unique */
        CougCrustStatusName varchar(50), /* CCR calls some statuses by different names b/c it does delivery*/
    CONSTRAINT PK_FulfillmentStatuses PRIMARY KEY NONCLUSTERED (StatusID ASC),
    CONSTRAINT UNIQUE_FulfillmentStatuses_StatusName UNIQUE (StatusName)
    )ON [PRIMARY]

    CREATE TABLE dbo.OutpostLocations(
        OutpostID       int             IDENTITY(1,1) NOT NULL, /* autogenerated index as PK*/
        OutpostName     varchar(50)     NOT NULL,  /* unique */
        OutpostAddress  varchar(max),
    CONSTRAINT PK_OutpostLocations PRIMARY KEY NONCLUSTERED (OutpostID ASC),
    CONSTRAINT UNIQUE_OutpostLocations_OutpostName UNIQUE (OutpostName)
    )ON [PRIMARY]

    CREATE TABLE dbo.DiningOptions(
        OptionID    int         NOT NULL, /* manual index for PK*/
        OptionName  varchar(50) NOT NULL,  /* unique */
    CONSTRAINT PK_OptionID PRIMARY KEY NONCLUSTERED (OptionID ASC),
    CONSTRAINT UNIQUE_DiningOptions_OptionName UNIQUE (OptionName)
    )ON [PRIMARY]


    CREATE TABLE dbo.Orders(
        OrderID             int IDENTITY(1,1)   NOT NULL,   /* autogenerated index as PK */
        BiteOrderID         varchar(50)         NOT NULL,   /* unique, long # from Bite that identifies a given order (does not repeat) */
        BiteOrderNum        varchar(50)         NOT NULL,   /* short number from Bite that repeats occasionally --> NON-UNIQUE */
        CreatedDate         datetime            NOT NULL,
        DiningOption        int                 NOT NULL,   /* FK to dbo.DiningOptions PK (OptionID) */
        OriginSiteID        int                 NOT NULL,   /* FK to dbo.FulfillmentSites PK (SiteID)  */
        OutpostLocationID   int,                            /* FK to dbo.DiningOptions PK (OptionID) */
        ReadyDate           datetime            NOT NULL,
        ReadyDateString     AS (CONVERT([varchar](10),[ReadyDate],(101))),
        ReadyTimeString     AS (CONVERT([varchar](8),format([ReadyDate],'h:mm tt'))),
        GuestID             varchar(50)         NOT NULL,
        GuestEmail          varchar(50)         NOT NULL,
        GuestPhone          varchar(50),
        FulfillmentStatus   int                 NOT NULL,   /* FK to dbo.FulfillmentStatuses PK (StatusID) */
        DeliveryAddress     varchar(max),
        RowVersion          rowversion          NOT NULL,   /* Sharepoint needs a rowversion column to do stuff (ask Nick) */
        TextMessageSent     bit DEFAULT((0))    NOT NULL,   /* boolean TRUE/FALSE value */
    CONSTRAINT PK_Orders PRIMARY KEY NONCLUSTERED (OrderID ASC),
    CONSTRAINT UNIQUE_Orders_BiteOrderID UNIQUE (BiteOrderID)
    )ON [PRIMARY]

    CREATE TABLE dbo.OrderItems(
        OrderItemID int             IDENTITY(1,1) NOT NULL, /* autogenerated index as PK*/
        OrderID     int             NOT NULL,   /* FK to dbo.Orders PK (OrderID) */
        ModString   varchar(max)    NOT NULL,
        ItemName    varchar(50)     NOT NULL,
        Quantity    tinyint         NOT NULL,
        SpecialNote varchar(max),
    CONSTRAINT PK_OrderItems PRIMARY KEY NONCLUSTERED (OrderItemID ASC)
    )ON [PRIMARY]
    GO

/****** ADDS FOREIGN KEYS ******/

	/* adds FK to FulfillmentSites */
	ALTER TABLE dbo.FulfillmentSites  WITH CHECK ADD CONSTRAINT FK_FulfillmentSites_DeliveryGroup FOREIGN KEY([DeliveryGroup])
	REFERENCES dbo.DeliveryGroups ([GroupID])

	/* adds FK to Orders */
	ALTER TABLE dbo.Orders  WITH CHECK ADD CONSTRAINT FK_Orders_SiteID FOREIGN KEY(OriginSiteID)
	REFERENCES dbo.FulfillmentSites (SiteID)
	ALTER TABLE dbo.Orders  WITH CHECK ADD CONSTRAINT FK_Orders_OutpostLocationID FOREIGN KEY(OutpostLocationID)
	REFERENCES dbo.OutpostLocations (OutpostID)
	ALTER TABLE dbo.Orders  WITH CHECK ADD CONSTRAINT FK_Orders_FulfillmentStatus FOREIGN KEY(FulfillmentStatus)
	REFERENCES dbo.FulfillmentStatuses (StatusID)
    ALTER TABLE dbo.Orders  WITH CHECK ADD CONSTRAINT FK_Orders_DiningOption FOREIGN KEY(DiningOption)
	REFERENCES dbo.DiningOptions (OptionID)

	/* adds FK to OrderItems */
	ALTER TABLE dbo.OrderItems WITH CHECK ADD CONSTRAINT FK_OrderItems_OrderID FOREIGN KEY(OrderID)
	REFERENCES dbo.Orders (OrderID)
	GO

    /* Adds nullity constraints to Orders to make sure that we either have an outpost ID or a delivery address */
    ALTER TABLE dbo.Orders ADD CONSTRAINT CHECK_Orders_has_delivery CHECK (not (OutpostLocationID is null and DeliveryAddress is null))
    ALTER TABLE dbo.Orders ADD CONSTRAINT CHECK_Orders_has_only_one_delivery CHECK (OutpostLocationID is null or DeliveryAddress is null)
    GO

/****** INSERTS SET-UP INFO ******/
    USE [ordering-app-db]
    GO

    INSERT INTO LastUpdatedTimestamp (LastUpdated) VALUES ('1997-01-01 12:00:00')
    GO

    INSERT INTO DeliveryGroups (GroupID, GroupName) VALUES ('1', 'Cougareat')
    INSERT INTO DeliveryGroups (GroupID, GroupName) VALUES ('2', 'Food-To-Go')
    GO

    /* these are the Bite DiningOptions, but with the " (contactless)" removed so that they look nicer in the frontend */
    INSERT INTO dbo.DiningOptions (OptionID, OptionName) VALUES ('1', 'Campus Delivery')
    INSERT INTO dbo.DiningOptions (OptionID, OptionName) VALUES ('2', 'Catering')
    GO

    INSERT INTO dbo.FulfillmentSites (SiteName, DeliveryGroup) VALUES ('Blue Ribbon Box', 2) /* ADD ADDRESS WHEN YOU CAN */
    INSERT INTO dbo.FulfillmentSites (SiteName, Address, DeliveryGroup) VALUES ('Chick-Fil-A', 'Brigham Young University, Ernest L. Wilkinson Student Center, Cougareat Food Court, Provo, UT 84602', 1)
    INSERT INTO dbo.FulfillmentSites (SiteName, Address, DeliveryGroup) VALUES ('Papa John''s', 'Brigham Young University, Ernest L. Wilkinson Student Center, Cougareat Food Court, Provo, UT 84602', 1)
    INSERT INTO dbo.FulfillmentSites (SiteName, Address, DeliveryGroup) VALUES ('Aloha Plate', 'Brigham Young University, Ernest L. Wilkinson Student Center, Cougareat Food Court, Provo, UT 84602', 1)
    INSERT INTO dbo.FulfillmentSites (SiteName, Address, DeliveryGroup) VALUES ('Wendy''s', 'Brigham Young University, Ernest L. Wilkinson Student Center, Cougareat Food Court, Provo, UT 84602', 1)
    INSERT INTO dbo.FulfillmentSites (SiteName, Address, DeliveryGroup) VALUES ('Milk and Cookies', 'Brigham Young University, Ernest L. Wilkinson Student Center, Cougareat Food Court, Provo, UT 84602', 1)
    INSERT INTO dbo.FulfillmentSites (SiteName, Address, DeliveryGroup) VALUES ('Subway', 'Brigham Young University, Ernest L. Wilkinson Student Center, Cougareat Food Court, Provo, UT 84602', 1)
    INSERT INTO dbo.FulfillmentSites (SiteName, Address, DeliveryGroup) VALUES ('Choices', 'Brigham Young University, Ernest L. Wilkinson Student Center, Cougareat Food Court, Provo, UT 84602', 1)
    INSERT INTO dbo.FulfillmentSites (SiteName, Address, DeliveryGroup) VALUES ('Taco Bell', 'Brigham Young University, Ernest L. Wilkinson Student Center, Cougareat Food Court, Provo, UT 84602', 1)
    INSERT INTO dbo.FulfillmentSites (SiteName, Address, DeliveryGroup) VALUES ('BYU-testing', 'Brigham Young University, Ernest L. Wilkinson Student Center, Cougareat Food Court, Provo, UT 84602', 1)
    INSERT INTO dbo.FulfillmentSites (SiteName, Address, DeliveryGroup) VALUES ('Creamery Marketplace', 'Brigham Young University, Ernest L. Wilkinson Student Center, Cougareat Food Court, Provo, UT 84602', 1)
    INSERT INTO dbo.FulfillmentSites (SiteName, DeliveryGroup) VALUES ('Cloned - Creamery Market', 1)
    INSERT INTO dbo.FulfillmentSites (SiteName, DeliveryGroup) VALUES ('Cougar Crust', 1)
    GO

    INSERT INTO dbo.FulfillmentStatuses (StatusID, StatusName, CougCrustStatusName) VALUES (1, 'New', 'New')
    INSERT INTO dbo.FulfillmentStatuses (StatusID, StatusName, CougCrustStatusName) VALUES (2, 'Prepared', 'Ready')
    INSERT INTO dbo.FulfillmentStatuses (StatusID, StatusName, CougCrustStatusName) VALUES (3, 'Collected', 'Pn Route')
    INSERT INTO dbo.FulfillmentStatuses (StatusID, StatusName, CougCrustStatusName) VALUES (4, 'Delivered', 'Delivered')
    INSERT INTO dbo.FulfillmentStatuses (StatusID, StatusName, CougCrustStatusName) VALUES (9, 'Cancelled', 'Cancelled')

    INSERT INTO dbo.OutpostLocations (OutpostName, OutpostAddress) VALUES ('TEST', 'test address')
    INSERT INTO dbo.OutpostLocations (OutpostName, OutpostAddress) VALUES ('USB', '685 E University Pkwy, Provo, UT 84604')
    INSERT INTO dbo.OutpostLocations (OutpostName, OutpostAddress) VALUES ('ASB', 'ASB, Campus Dr, Provo, UT 84604')
    INSERT INTO dbo.OutpostLocations (OutpostName, OutpostAddress) VALUES ('TNRB', 'TNRB, Brigham Young University, Provo, UT 84602')
    INSERT INTO dbo.OutpostLocations (OutpostName, OutpostAddress) VALUES ('Creamery on Ninth', '1209 900 E, Provo, UT 84604')
    INSERT INTO dbo.OutpostLocations (OutpostName, OutpostAddress) VALUES ('Heritage Halls Building 2', '2 Heritage Halls')
    INSERT INTO dbo.OutpostLocations (OutpostName, OutpostAddress) VALUES ('Heritage Halls Building 3', '3 Heritage Halls')
    INSERT INTO dbo.OutpostLocations (OutpostName, OutpostAddress) VALUES ('Heritage Halls Building 4', '4 Heritage Halls')
    INSERT INTO dbo.OutpostLocations (OutpostName, OutpostAddress) VALUES ('Heritage Halls Building 5', '5 Heritage Halls')
    INSERT INTO dbo.OutpostLocations (OutpostName, OutpostAddress) VALUES ('Heritage Halls Building 6', '6 Heritage Halls')
    INSERT INTO dbo.OutpostLocations (OutpostName, OutpostAddress) VALUES ('Heritage Halls Building 7', '7 Heritage Halls')
    INSERT INTO dbo.OutpostLocations (OutpostName, OutpostAddress) VALUES ('Heritage Halls Building 8', '8 Heritage Halls')
    INSERT INTO dbo.OutpostLocations (OutpostName, OutpostAddress) VALUES ('Heritage Halls Building 9', '9 Heritage Halls')
    INSERT INTO dbo.OutpostLocations (OutpostName, OutpostAddress) VALUES ('Heritage Halls Building 10', '10 Heritage Halls')
    INSERT INTO dbo.OutpostLocations (OutpostName, OutpostAddress) VALUES ('Heritage Halls Building 11', '11 Heritage Halls')
    INSERT INTO dbo.OutpostLocations (OutpostName, OutpostAddress) VALUES ('Heritage Halls Building 12', '12 Heritage Halls')
    INSERT INTO dbo.OutpostLocations (OutpostName, OutpostAddress) VALUES ('Heritage Halls Building 13', '13 Heritage Halls')
    INSERT INTO dbo.OutpostLocations (OutpostName, OutpostAddress) VALUES ('Heritage Halls Building 14', '15 Heritage Halls')
    INSERT INTO dbo.OutpostLocations (OutpostName, OutpostAddress) VALUES ('Heritage Halls Building 15', '15 Heritage Halls')
    INSERT INTO dbo.OutpostLocations (OutpostName, OutpostAddress) VALUES ('Heritage Halls Building 16', '16 Heritage Halls')
    GO